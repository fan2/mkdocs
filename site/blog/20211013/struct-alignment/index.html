
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="在别处或在路上">
      
      
        <meta name="author" content="Cliff Fan">
      
      
        <link rel="canonical" href="https://duetorun.com/blog/20211013/struct-alignment/">
      
      
        <link rel="prev" href="../../20211012/address-alignment/">
      
      
        <link rel="next" href="../../20221212/2-Markdown-Formula/">
      
      
      <link rel="icon" href="../../../assets/hold_yourself.jpg">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.15">
    
    
      
        <title>Struct Alignment - ElseWhere</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-XGW41EGL31"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-XGW41EGL31",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-XGW41EGL31",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#struct_padding_holes" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="ElseWhere" class="md-header__button md-logo" aria-label="ElseWhere" data-md-component="logo">
      
  <img src="../../../assets/hold_yourself.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ElseWhere
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Struct Alignment
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../about/" class="md-tabs__link">
        
  
    
  
  About

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../link/" class="md-tabs__link">
        
  
    
  
  Link

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="ElseWhere" class="md-nav__button md-logo" aria-label="ElseWhere" data-md-component="logo">
      
  <img src="../../../assets/hold_yourself.jpg" alt="logo">

    </a>
    ElseWhere
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2024/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2023/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2021
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2020/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2020
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2019/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2019
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2018/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2018
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2017/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2017
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2015/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2015
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2009/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2009
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Categories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/cs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/c/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    c
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/cpp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cpp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/editor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    editor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/excerpt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    excerpt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/git/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    git
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/macos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    macOS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/markdown/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    markdown
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/material/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    material
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/mkdocs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mkdocs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/nginx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nginx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/resource/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    resource
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/samba/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    samba
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/shell/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    shell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/toolchain/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    toolchain
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/ubuntu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ubuntu
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/vim/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vim
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/webdav/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    webDAV
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/wiki/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    wiki
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../category/zsh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zsh
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../link/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Link
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#struct_padding_holes" class="md-nav__link">
    <span class="md-ellipsis">
      struct padding holes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="struct padding holes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tcpl" class="md-nav__link">
    <span class="md-ellipsis">
      TCPL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcpl_1" class="md-nav__link">
    <span class="md-ellipsis">
      TC++PL
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#struct_alignment_rule" class="md-nav__link">
    <span class="md-ellipsis">
      struct alignment rule
    </span>
  </a>
  
    <nav class="md-nav" aria-label="struct alignment rule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#largest_member_ﬁrst" class="md-nav__link">
    <span class="md-ellipsis">
      largest member ﬁrst
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#largest_member_middle" class="md-nav__link">
    <span class="md-ellipsis">
      largest member middle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct_array" class="md-nav__link">
    <span class="md-ellipsis">
      struct array
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compiler_support" class="md-nav__link">
    <span class="md-ellipsis">
      compiler support
    </span>
  </a>
  
    <nav class="md-nav" aria-label="compiler support">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default_alignment" class="md-nav__link">
    <span class="md-ellipsis">
      default alignment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#biggest_alignment" class="md-nav__link">
    <span class="md-ellipsis">
      BIGGEST_ALIGNMENT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gccmsvc_specific" class="md-nav__link">
    <span class="md-ellipsis">
      gcc/msvc specific
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gcc_-fpack-struct" class="md-nav__link">
    <span class="md-ellipsis">
      gcc -fpack-struct
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pragma_pack" class="md-nav__link">
    <span class="md-ellipsis">
      #pragma pack
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test_alignment" class="md-nav__link">
    <span class="md-ellipsis">
      test alignment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="test alignment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#interpretation" class="md-nav__link">
    <span class="md-ellipsis">
      interpretation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refs" class="md-nav__link">
    <span class="md-ellipsis">
      refs
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
                  <span class="md-ellipsis">
                    回到主页
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="https://duetorun.com/assets/carve_yourself.jpg" alt="Cliff Fan">
                    </span>
                    <span class="md-profile__description">
                      <strong>
                        
                          Cliff Fan
                        
                      </strong>
                      <br>
                      Just do IT
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    元数据
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5v-5Z"/></svg>
                        <time datetime="2021-10-13 10:00:00" class="md-ellipsis">2021年10月13日</time>
                      </div>
                    </li>
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15 13h1.5v2.82l2.44 1.41-.75 1.3L15 16.69V13m4-5H5v11h4.67c-.43-.91-.67-1.93-.67-3a7 7 0 0 1 7-7c1.07 0 2.09.24 3 .67V8M5 21a2 2 0 0 1-2-2V5c0-1.11.89-2 2-2h1V1h2v2h8V1h2v2h1a2 2 0 0 1 2 2v6.1c1.24 1.26 2 2.99 2 4.9a7 7 0 0 1-7 7c-1.91 0-3.64-.76-4.9-2H5m11-9.85A4.85 4.85 0 0 0 11.15 16c0 2.68 2.17 4.85 4.85 4.85A4.85 4.85 0 0 0 20.85 16c0-2.68-2.17-4.85-4.85-4.85Z"/></svg>
                          <time datetime="2024-05-02 12:00:00" class="md-ellipsis">2024年5月2日</time>
                        </div>
                      </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3H9m3 2 4 13 3-1-4-13-3 1M5 5v13h3V5H5M3 19v2h18v-2H3Z"/></svg>
                          <span class="md-ellipsis">
                            分类于
                            
                              <a href="../../category/cs/">CS</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7h1.5Z"/></svg>
                          <span class="md-ellipsis">
                            
                              需要 15 分钟阅读时间
                            
                          </span>
                        </div>
                      </li>
                    
                    <!-- Add by Cliff.Fan, 29Mar24. -->
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 1-5 5v11l5-4.5V1m2 4v13.5c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6c-1.45-1.1-3.55-1.5-5.5-1.5-1.95 0-4.05.4-5.5 1.5v14.65c0 .25.25.5.5.5.1 0 .15-.05.25-.05C3.1 20.45 5.05 20 6.5 20c1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.3 4.75 1.05.1.05.15.05.25.05.25 0 .5-.25.5-.5V6c-.6-.45-1.25-.75-2-1M10 18.41C8.75 18.09 7.5 18 6.5 18c-1.06 0-2.32.19-3.5.5V7.13c.91-.4 2.14-.63 3.5-.63 1.36 0 2.59.23 3.5.63v11.28Z"/></svg>
                        <span class="md-ellipsis" id="busuanzi_container_page_pv">
                          阅读量：<span id="busuanzi_value_page_pv">N/A</span>
                        </span>
                      </div>
                    </li>
                  </ul>
                </nav>
              </li>
            </ul>
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  
  

<nav class="md-tags" >
  
    
    
    
      <span class="md-tag">struct</span>
    
  
    
    
    
      <span class="md-tag">alignment</span>
    
  
</nav>



  <h1>Struct Alignment</h1>

<p>An object doesn't just need enough storage to hold its representation. In addition, on some machine architectures, the bytes used to hold it must have proper alignment for the hardware to access it efﬁciently.</p>
<p>Where alignment most often becomes visible is in object layouts: sometimes structs contain "<code>holes</code>" to improve alignment.</p>
<!-- more -->

<h2 id="struct_padding_holes">struct padding holes<a class="headerlink" href="#struct_padding_holes" title="Permanent link">#</a></h2>
<h3 id="tcpl">TCPL<a class="headerlink" href="#tcpl" title="Permanent link">#</a></h3>
<p>Excerpt from <a href="https://www.amazon.com/Programming-Language-2nd-Brian-Kernighan/dp/0131103628/">C Programming Language, 2nd Edition - 1988</a>.</p>
<hr />
<p><strong>6.4 Pointers to Structures</strong></p>
<p>Don't assume, however, that the size of a structure is the sum of the sizes of its members. Because of alignment requirements for different objects, there may be unnamed "<code>holes</code>" in a structure. Thus, for instance, if a char is one byte and an int four bytes, the structure.</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">};</span>
</span></code></pre></div>
<p>might well require eight bytes, not five. The <code>sizeof</code> operator returns the proper value.</p>
<hr />
<p><strong>6.5 Self-referential Structures</strong></p>
<p>objects of certain types must satisfy alignment restrictions</p>
<p>Alignment requirements can generally be satisfied easily, at the cost of some wasted space, by ensuring that the allocator always returns a pointer that meets <em>all</em> alignment restrictions.</p>
<h3 id="tcpl_1">TC++PL<a class="headerlink" href="#tcpl_1" title="Permanent link">#</a></h3>
<p>Excerpt from <a href="https://www.stroustrup.com/4th.html">The C++ Programming Language(4e)-2013</a>.</p>
<hr />
<ol start="6">
<li>Types and Declarations | 6.2 Types | <strong>6.2.9 Alignment</strong></li>
</ol>
<p>An object doesn't just need enough storage to hold its representation. In addition, on some machine architectures, the bytes used to hold it must have proper alignment for the hardware to access it efﬁciently (or in extreme cases to access it at all). For example, a 4-byte <code>int</code> often has to be aligned on a word (4-byte) boundary, and sometimes an 8-byte <code>double</code> has to be aligned on a word (8-byte) boundary. Of course, this is all very implementation speciﬁc, and for most programmers completely implicit. You can write good C++ code for decades without needing to be explicit about alignment. Where alignment most often becomes visible is in object layouts: sometimes structs contain "<code>holes</code>" to improve alignment.</p>
<p>The <code>alignof</code> operator returns the alignment of its argument expression.</p>
<hr />
<ol start="8">
<li>Structures, Unions, and Enumerations | 8.2 Structures | <strong>8.2.1 struct Layout</strong></li>
</ol>
<p>An object of a <strong>struct</strong> holds its members in the order they are declared. For example, we might store primitive equipment readout in a structure like this:</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Readout</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">hour</span><span class="p">;</span><span class="w">  </span><span class="c1">// [0:23]</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span><span class="w">   </span><span class="c1">// sequence mark [&#39;a&#39;:&#39;z&#39;]</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="p">};</span>
</span></code></pre></div>
<p>You could imagine the members of a <code>Readout</code> object laid out in memory like this:</p>
<p><img alt="struct-Readout-1" src="../../cs/images/alignment/struct-Readout-1.png" /></p>
<p>Members are allocated in memory in declaration order, so the address of <code>hour</code> must be less than the address of <code>value</code>. See also §8.2.6.</p>
<p>However, the size of an object of a <strong>struct</strong> is not necessarily the sum of the sizes of its members. This is because many machines require objects of certain types to be allocated on architecture dependent <em>boundaries</em> or handle such objects much more <em>efﬁciently</em> if they are. For example, integers are often allocated on word boundaries. On such machines, objects are said to have to be properly <strong><em>aligned</em></strong> (§6.2.9). This leads to "<code>holes</code>" in the structures. A more realistic layout of a <code>Readout</code> on a machine with 4-byte int would be:</p>
<p><img alt="struct-Readout-2" src="../../cs/images/alignment/struct-Readout-2.png" /></p>
<p>In this case, as on many machines, <code>sizeof(Readout)</code> is 12, and not 6 as one would naively expect from simply adding the sizes of the individual members.</p>
<p>You can minimize wasted space by simply ordering members by size (<em>largest member ﬁrst</em>). For example:</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Readout</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">hour</span><span class="p">;</span><span class="w">  </span><span class="c1">// [0:23]</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span><span class="w">   </span><span class="c1">// sequence mark [&#39;a&#39;:&#39;z&#39;]</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="p">};</span>
</span></code></pre></div>
<p><img alt="struct-Readout-3" src="../../cs/images/alignment/struct-Readout-3.png" /></p>
<p>Note that this still leaves a 2-byte "<code>hole</code>" (unused space) in a <code>Readout</code> and <code>sizeof(Readout)==8</code>. The reason is that we need to maintain alignment when we put two objects next to each other, say, in an array of <code>Readout</code>s. The size of an array of 10 <code>Readout</code> objects is <code>10∗sizeof(Readout)</code>.</p>
<p>It is usually best to order members for readability and sort them by size only if there is a demonstrated need to optimize.</p>
<p>Use of multiple access speciﬁers (i.e., <code>public</code>, <code>private</code>, or <code>protected</code>) can affect layout (§20.5).</p>
<h2 id="struct_alignment_rule">struct alignment rule<a class="headerlink" href="#struct_alignment_rule" title="Permanent link">#</a></h2>
<p>在上一节 <a href="../../20211012/address-alignment/">Memory Address Alignment</a> 中，提到了基础类型（basic/fundamental types）的自然对齐规则（natural alignment rule）：任何 <span class="arithmatex">\(K\)</span> 字节的基本对象的存储地址必须是 <span class="arithmatex">\(K\)</span> 的倍数。</p>
<p>结构体成员变量的存放地址也有“地址边界对齐限制”：在默认编译配置下，成员变量存放的地址相对结构体起始地址的<strong>偏移量</strong>也必须满足自然对齐，即偏移量为该成员变量自身类型大小的倍数。</p>
<p>各成员变量在存放的时候根据在结构体中声明的顺序依次申请空间，同时按照“地址边界对齐限制”原则调整存放位置（地址），空缺的字节会自动填充。</p>
<h3 id="largest_member_ﬁrst">largest member ﬁrst<a class="headerlink" href="#largest_member_ﬁrst" title="Permanent link">#</a></h3>
<p>下面以 <code>struct st_dci</code> 为例来说明结构体的存储布局。</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">st_dci</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="p">{</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="p">};</span>
</span></code></pre></div>
<ol>
<li>先为 <code>d</code> 分配存储空间，其起始地址和结构体起始地址相同，偏移量0为sizeof(double)=8的倍数，占用8字节。</li>
<li>再为 <code>c</code> 分配存储空间，地址偏移量为8，是sizeof(char)=1的倍数，占用1个字节。</li>
<li>继续为 <code>i</code> 分配存储空间，地址偏移量为9，不是sizeof(int)=4的倍数。为满足“地址边界对齐限制”，将自动填充3个字节，在偏移量为12的地址处存放 i，占用4个字节。</li>
</ol>
<p>至此，各成员变量都已分配了相对地址，sizeof(struct st_dci) = 8+1+(3)+4=16。其中，括号里的 <em>3</em> 为 padding bits 位数。</p>
<blockquote>
<p>20230510 - <a href="https://www.open-std.org/jtc1/sc22/wg21/docs/papers/2023/n4950.pdf">ISO/IEC-N4950</a> - 6.8.2 Fundamental types: Padding bits have <em>unspecified</em> value, but cannot cause traps.</p>
</blockquote>
<p>可以调用 &lt;stddef.h&gt; 中定义的宏 <a href="https://en.wikibooks.org/wiki/C_Programming/stddef.h/Function_reference#offsetof">offsetof</a> 来读取各个成员的实际偏移量。</p>
<h3 id="largest_member_middle">largest member middle<a class="headerlink" href="#largest_member_middle" title="Permanent link">#</a></h3>
<p>上面的 <code>struct st_dci</code> 是一种类似 TC++PL 中调整后的 struct Readout - largest member ﬁrst 的内存布局。</p>
<p>交换一下成员变量d和c的位置，将占位最长的 d 放在中间，新的结构体 <code>struct st_cdi</code> 的内存布局和占用空间又是怎样的呢？</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">st_cdi</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="p">{</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="p">};</span>
</span></code></pre></div>
<p>按照结构体成员变量的“地址边界对齐限制”原则，分析一下 <code>struct st_cdi</code> 的地址分配。</p>
<ol>
<li>先为 <code>c</code> 分配存储空间，其起始地址和结构体起始地址相同，是sizeof(char)=1的倍数，占用1个字节。</li>
<li>再为 <code>d</code> 分配存储空间，地址偏移量为1，不是sizeof(double)=8的倍数，为满足“地址边界对齐限制”，先填充7个字节，再从地址偏移量为8的地址处存放d，占用8字节。</li>
<li>继续为 <code>i</code> 分配存储空间，地址偏移量为16，是sizeof(int)=4的倍数。</li>
</ol>
<p>经以上推演相对存储分配布局后，sizeof(struct st_cdi) = 1+(7)+8+4=20。其中，括号里的 <em>7</em> 为 padding bits 位数。</p>
<p>按照成员变量的“地址边界对齐限制”原则，似乎已经讨论完毕，但问题不止如此。</p>
<p>结构体 <code>struct st_cdi</code> 最终的实际大小，请见下节分析。</p>
<h3 id="struct_array">struct array<a class="headerlink" href="#struct_array" title="Permanent link">#</a></h3>
<p>考虑定义一个结构体 <code>struct st_cdi</code> 的数组：</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">st_cdi</span><span class="w"> </span><span class="n">st</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span></code></pre></div>
<p>按照上面的讨论，sizeof(struct st_cdi)=20，假设数组（第一个结构体）的起始地址为 Sa，则第二、三、四个结构体的地址分别为 Sa+20, Sa+40, Sa+60。</p>
<p>第一个结构体 st[0] 内部的成员 c、d、i 固然能满足“地址边界对齐限制”，但是紧随其后的第二、三、四个结构体中的每个成员变量是否能满足“地址边界对齐限制”呢？</p>
<p>以第二个结构体 st[1] 为例，其起始地址为 Sa+20，成员 c 满足对齐限制，占用1字节+填充7字节后，成员 d 的起始地址为 Sa+28。取 Sa 为典型的 8 或 16，均不能满足 d 的“地址边界对齐限制”。</p>
<p>实际上，编译器在为 <code>struct st_cdi</code> 分配空间时，除了使每个成员变量满足“地址边界对齐限制”外，还必须保证结构体所占的总字节数是结构中最长类型所占字节数（这里是sizeof(double)=8）的倍数（satisfy the strictest alignment requirement）。</p>
<p>具体来说，在为最后一个成员变量 i 分配地址后，已占 20 个字节，还必须在尾部填充4个字节。这样，结构体整体大小 sizeof(struct st_cdi) = 1+(7)+8+4+(4)=24，为 8 的倍数。</p>
<p>只要确保结构数组起始地址 Sa（&amp;st[0]）是 8 的倍数，就能够保证其后的每个元素（st[1]，st[2]，...）中的成员变量都满足自身的地址对齐限制。</p>
<h2 id="compiler_support">compiler support<a class="headerlink" href="#compiler_support" title="Permanent link">#</a></h2>
<p>GCC - <a href="https://gcc.gnu.org/onlinedocs/gcc/Alignment.html">Determining the Alignment of Functions, Types or Variables</a>: The keyword <code>__alignof__</code> determines the alignment requirement of a function, object, or a type, or the minimum alignment usually required by a type. Its syntax is just like sizeof and <a href="https://en.cppreference.com/w/c/keyword/_Alignof">C11 _Alignof</a>(<a href="https://en.cppreference.com/w/c/language/_Alignof">until C23</a>).</p>
<p><a href="https://learn.microsoft.com/en-us/cpp/cpp/alignof-operator?view=msvc-170">Microsoft-specific</a>: <code>alignof</code> and <code>__alignof</code> are synonyms in the Microsoft compiler. Before it became part of the standard in C++11, the Microsoft-specific <code>__alignof</code> operator provided this functionality.</p>
<blockquote>
<p>For maximum portability, you should use the <a href="https://en.cppreference.com/w/c/types">alignof</a> operator instead of the <br />
GCC-specific <code>__alignof__</code> operator or Microsoft-specific <code>__alignof</code> operator.</p>
</blockquote>
<p>此外，编译器提供的编译配置选项，使得我们有机会修改默认的对齐方式，自行设定变量的对齐方式。</p>
<h3 id="default_alignment">default alignment<a class="headerlink" href="#default_alignment" title="Permanent link">#</a></h3>
<p>参考上一篇 《<a href="../../20211012/address-alignment/">Memory Address Alignment</a>》 中的 natural alignment 部分。</p>
<p><strong>MSVC</strong> - <a href="https://learn.microsoft.com/en-us/cpp/build/reference/zp-struct-member-alignment">/Zp (Struct Member Alignment)</a>：Controls how the members of a structure are packed into memory and specifies the same packing for all structures in a module.</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/cpp/build/x64-software-conventions#x64-type-and-storage-layout">x64 ABI conventions</a> - <a href="https://learn.microsoft.com/en-us/cpp/build/x64-software-conventions#x64-type-and-storage-layout">x64 type and storage layout</a> - Scalar types alignment</li>
</ul>
<table>
<thead>
<tr>
<th>/Zp argument</th>
<th>Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Packs structures on 1-byte boundaries. Same as <code>/Zp</code>.</td>
</tr>
<tr>
<td>2</td>
<td>Packs structures on 2-byte boundaries.</td>
</tr>
<tr>
<td>4</td>
<td>Packs structures on 4-byte boundaries.</td>
</tr>
<tr>
<td>8</td>
<td>Packs structures on 8-byte boundaries (default for x86, ARM, and ARM64).</td>
</tr>
<tr>
<td>16</td>
<td>Packs structures on 16-byte boundaries (default for x64 and ARM64EC).</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Don't use this option unless you have specific alignment requirements.</p>
</blockquote>
<p>在 MSVC Project Settings-&gt;C/C++-&gt;Struct member alignment 中默认值为 8，可在程序中使用 <code>#pragma pack</code> 预处理来指定。</p>
<p>32、64 位下的基本数据类型占用最大空间是 8 字节（sizeof(long long)、sizeof(double)），这个也是自然对齐的最大参数。</p>
<div class="admonition warning">
<p class="admonition-title">Don't change the default alignment</p>
<p>The C/C++ headers in the Windows SDK assume the platform's <em>default</em> alignment is used. Don't change the setting from the default when you include the Windows SDK headers, either by using <code>/Zp</code> on the command line or by using <code>#pragma pack</code>. Otherwise, your application may cause memory corruption at runtime.</p>
</div>
<p><strong>GCC</strong> - <a href="https://gcc.gnu.org/onlinedocs/gcc/Common-Variable-Attributes.html">Common Variable Attributes</a>:</p>
<p>As in the preceding examples, you can explicitly specify the alignment (in bytes) that you wish the compiler to use for a given variable or structure field. Alternatively, you can leave out the alignment factor and just ask the compiler to align a variable or field to the default alignment for the target architecture you are compiling for. The default alignment is <strong>fixed</strong> for a particular target ABI.</p>
<ul>
<li>pipermail/gcc-help - <a href="https://gcc.gnu.org/pipermail/gcc-help/2015-June/124424.html">default alignment</a></li>
</ul>
<p><a href="https://developer.arm.com/documentation/101754/0622/armclang-Reference/Compiler-specific-Function--Variable--and-Type-Attributes/--attribute----aligned---type-attribute">Arm Compiler for Embedded Reference Guide</a>:</p>
<ul>
<li>For <code>AArch32</code>, the default alignment is 8 bytes.</li>
<li>For <code>AArch64</code>, the default alignment is 16 bytes.</li>
</ul>
<h3 id="biggest_alignment">BIGGEST_ALIGNMENT<a class="headerlink" href="#biggest_alignment" title="Permanent link">#</a></h3>
<p>The default alignment is <em>sufficient</em> for all scalar types, but may not be enough for all vector types on a target that supports vector operations.</p>
<div class="admonition note">
<p class="admonition-title">x86 strictest 16-bytes alignment</p>
<p><a href="https://en.wikibooks.org/wiki/X86_Assembly/SSE#SSE2:_Added_with_Pentium_4">x86 Assembly/SSE</a> - <code>movapd</code>: move two 64-bit(double precision) floats, vector is 16 byte aligned. Refer to <a href="https://www.gamedev.net/blog/615/entry-2250281-demystifying-sse-move-instructions/">Demystifying SSE Move Instructions</a>.</p>
<p><a href="https://learn.microsoft.com/en-us/cpp/build/x64-calling-convention">x64 calling convention</a> - <a href="https://learn.microsoft.com/en-us/cpp/build/x64-calling-convention#alignment">Alignment</a>: Most structures are aligned to their natural alignment. The primary exceptions are the stack pointer and <code>malloc</code> or <code>alloca</code> memory, which are 16-byte aligned to aid performance. Alignment above 16 bytes must be done manually. Since 16 bytes is a common alignment size for <strong>XMM</strong> operations, this value should work for most code. For more information about structure layout and alignment, see <a href="https://learn.microsoft.com/en-us/cpp/build/x64-software-conventions#x64-type-and-storage-layout">x64 type and storage layout</a>. For information about the stack layout, see <a href="https://learn.microsoft.com/en-us/cpp/build/stack-usage">x64 stack usage</a>.</p>
</div>
<p><a href="https://gcc.gnu.org/onlinedocs/gcc/Common-Variable-Attributes.html">GCC</a> also provides a target specific macro <code>__BIGGEST_ALIGNMENT__</code>, which is the <em>largest</em> alignment ever used for <em>any</em> data type on the target machine you are compiling for.</p>
<div class="admonition warning">
<p class="admonition-title">linker limitations for maximal alignment size</p>
<p>Note that the effectiveness of aligned attributes for static variables may be limited by inherent limitations in the system linker and/or object file format. On some systems, the linker is only able to arrange for variables to be aligned up to a certain maximum alignment. (For some linkers, the maximum supported alignment may be very very small.) If your linker is only able to align variables up to a maximum of 8-byte alignment, then specifying aligned(16) in an <code>__attribute__</code> still only provides you with 8-byte alignment. See your linker documentation for further information.</p>
<p>Stack variables are not affected by linker restrictions; GCC can properly align them on any target.</p>
</div>
<p>可以借助 cpp / gcc -E -dM 预编译，过滤打印出 <code>__BIGGEST_ALIGNMENT__</code> 宏定义：</p>
<div class="language-Shell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>$<span class="w"> </span>gcc<span class="w"> </span>-dM<span class="w"> </span>-E<span class="w"> </span>-arch<span class="w"> </span>armv7<span class="w"> </span>-x<span class="w"> </span>c<span class="w"> </span>/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;__BIGGEST_ALIGNMENT__&#39;</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>$<span class="w"> </span>gcc<span class="w"> </span>-dM<span class="w"> </span>-E<span class="w"> </span>-arch<span class="w"> </span>arm<span class="w"> </span>-x<span class="w"> </span>c<span class="w"> </span>/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;__BIGGEST_ALIGNMENT__&#39;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>$<span class="w"> </span>gcc<span class="w"> </span>-dM<span class="w"> </span>-E<span class="w"> </span>-arch<span class="w"> </span>arm64<span class="w"> </span>-x<span class="w"> </span>c<span class="w"> </span>/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;__BIGGEST_ALIGNMENT__&#39;</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>$<span class="w"> </span>gcc<span class="w"> </span>-dM<span class="w"> </span>-E<span class="w"> </span>-arch<span class="w"> </span>x86_64<span class="w"> </span>-x<span class="w"> </span>c<span class="w"> </span>/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;__BIGGEST_ALIGNMENT__&#39;</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>$<span class="w"> </span>gcc<span class="w"> </span>-dM<span class="w"> </span>-E<span class="w"> </span>-x<span class="w"> </span>c<span class="w"> </span>/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;__BIGGEST_ALIGNMENT__&#39;</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cpp<span class="w"> </span>-dM<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;__BIGGEST_ALIGNMENT__&#39;</span>
</span></code></pre></div>
<p>测试结果：</p>
<ul>
<li>macOS clang/llvm-gcc ： armv7、arm 下定义为 4；arm64 下定义为 8；x86_64 下定义为 16。</li>
<li>在 rpi3b-raspbian/armv7l(armhf? aarch32?) 下定义为 8；在 rpi3b-ubuntu/aarch64 下定义为 16。</li>
<li>在 rpi4b-ubuntu/aarch64 下定义为 16。</li>
</ul>
<div class="admonition abstract">
<p class="admonition-title">std::max_align_t</p>
<p><a href="https://en.cppreference.com/w/c/types/max_align_t">max_align_t</a>(since C11) is a type whose alignment requirement is at least as strict (as large) as that of every scalar type.</p>
<p>Pointers returned by allocation functions such as malloc are suitably aligned for <em>any</em> object, which means they are aligned at <em>least</em> as strictly as <code>max_align_t</code>.</p>
<p>文末测试程序 struct-packed-aligned.c 测得的 <code>alignof(max_align_t)</code> 数值同对应平台上的 <code>__BIGGEST_ALIGNMENT__</code>。</p>
</div>
<h3 id="gccmsvc_specific">gcc/msvc specific<a class="headerlink" href="#gccmsvc_specific" title="Permanent link">#</a></h3>
<p>GCC specific <a href="https://gcc.gnu.org/onlinedocs/gcc/Common-Variable-Attributes.html">Common Variable Attributes</a> 提供了属性修饰声明 <code>__attribute__</code>，支持定义变量的存储布局为 <code>packed</code>，或通过 <code>aligned [(n)]</code> 改变默认对齐字节数。</p>
<ol>
<li>
<p>The <code>packed</code> attribute specifies that a structure member should have the <strong><em>smallest</em></strong> possible alignment—one bit for a bit-field and one byte otherwise, unless a larger value is specified with the <code>aligned</code> attribute. The attribute <em>does not</em> apply to non-member objects.</p>
<ul>
<li><code>struct __attribute__((__packed__))</code> 相当于 <code>-fpack-struct</code>，开启 Packed alignment mode，按 1 字节对齐（<em>without</em> holes），satisfies weakest alignment requirement。</li>
</ul>
</li>
<li>
<p>The <code>aligned</code> attribute specifies a <strong><em>minimum</em></strong> alignment for the variable or structure field, measured in bytes. When specified, alignment must be an integer constant power of 2. Specifying <em>no</em> alignment argument implies the <strong><em>maximum</em></strong> alignment for the target, which is often, but by no means always, 8 or 16 bytes.</p>
<ul>
<li>当 <code>__attribute__((aligned))</code> 不指定参数时，相当于 Natural alignment mode，采用默认的 default maximum alignment 对齐策略。</li>
</ul>
</li>
</ol>
<p><a href="https://learn.microsoft.com/en-us/cpp/cpp/align-cpp?view=msvc-170">align (C++)</a> - Microsoft Specific</p>
<blockquote>
<p>Use <code>__declspec(align(n))</code> to precisely control the alignment of user-defined data (for example, static allocations or automatic data in a function).</p>
</blockquote>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="cp">#define CACHE_LINE  32</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="cp">#define CACHE_ALIGN __declspec(align(CACHE_LINE))</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="k">struct</span><span class="w"> </span><span class="nc">CACHE_ALIGN</span><span class="w"> </span><span class="n">S1</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// cache align all instances of S1</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="p">};</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="k">struct</span><span class="w"> </span><span class="nc">S1</span><span class="w"> </span><span class="n">s1</span><span class="p">;</span><span class="w">   </span><span class="c1">// s1 is 32-byte cache aligned</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="c1">// sizeof(struct S2) = 16</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="kr">__declspec</span><span class="p">(</span><span class="n">align</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">S2</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="p">};</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="c1">// sizeof(struct S3) = 64.</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="k">struct</span><span class="w"> </span><span class="nc">S3</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="w">   </span><span class="k">struct</span><span class="w"> </span><span class="nc">S1</span><span class="w"> </span><span class="n">s1</span><span class="p">;</span><span class="w">   </span><span class="c1">// S3 inherits cache alignment requirement</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="w">                  </span><span class="c1">// from S1 declaration</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w">         </span><span class="c1">// a is now cache aligned because of s1</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="w">                  </span><span class="c1">// 28 bytes of trailing padding</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="p">};</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="c1">// sizeof(struct S4) = 64.</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="k">struct</span><span class="w"> </span><span class="nc">S4</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a><span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a><span class="w">   </span><span class="c1">// 28 bytes padding</span>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="w">   </span><span class="k">struct</span><span class="w"> </span><span class="nc">S1</span><span class="w"> </span><span class="n">s1</span><span class="p">;</span><span class="w">      </span><span class="c1">// S4 inherits cache alignment requirement of S1</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a><span class="p">};</span>
</span></code></pre></div>
<p>related topics:</p>
<ul>
<li><a href="https://softwareengineering.stackexchange.com/questions/256179/the-advantage-of-using-attribute-aligned">c - The advantage of using __attribute__((aligned( )))</a></li>
<li><a href="https://stackoverflow.com/questions/7895869/cross-platform-alignx-macro">visual c++ - Cross-platform ALIGN(x) macro?</a></li>
</ul>
<h3 id="gcc_-fpack-struct">gcc -fpack-struct<a class="headerlink" href="#gcc_-fpack-struct" title="Permanent link">#</a></h3>
<p>GCC specific <a href="https://gcc.gnu.org/onlinedocs/gcc/Code-Gen-Options.html">Options for Code Generation Conventions</a> 支持编译选项 <code>-fpack-struct[=n]</code> 指定结构体中成员变量的对齐字节数。</p>
<blockquote>
<p>Without a value specified, pack all structure members together <em>without</em> holes. When a value is specified (which must be a small power of two), pack structure members according to this value, representing the <strong><em>maximum</em></strong> alignment (that is, objects with default alignment requirements larger than this are output potentially unaligned at the next fitting location.</p>
</blockquote>
<p>当不指定参数时，<code>-fpack-struct</code> 相当于 <code>struct __attribute__((__packed__))</code>，满足 weakest alignment requirement，按 1 字节对齐。</p>
<p><a href="https://en.wikipedia.org/wiki/Data_structure_alignment">Data structure alignment</a>: Alternatively, one can <strong><em>pack</em></strong> the structure, omitting the padding, which may lead to slower access, but uses three quarters as much memory.</p>
<h3 id="pragma_pack">#pragma pack<a class="headerlink" href="#pragma_pack" title="Permanent link">#</a></h3>
<p>GCC - <a href="https://gcc.gnu.org/onlinedocs/gcc/Structure-Layout-Pragmas.html">Structure-Layout Pragmas</a><br />
<a href="https://learn.microsoft.com/en-us/cpp/preprocessor/pack">pack pragma | Microsoft Learn</a></p>
<ul>
<li><code>#pragma pack(show)</code>: Displays the current byte value for packing alignment. The value is displayed by a warning message.</li>
</ul>
<p><code>#pragma pack(show)</code> 测试代码：</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="cp">#pragma pack(show)</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="p">{</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>macOS（Intel x86_64、Apple Silicon arm64）下 clang/llvm-gcc 编译输出警告：</p>
<div class="language-Shell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>$<span class="w"> </span>cc<span class="w"> </span>-S<span class="w"> </span>pack-show.c
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>pack-show.c:1:9:<span class="w"> </span>warning:<span class="w"> </span>value<span class="w"> </span>of<span class="w"> </span><span class="c1">#pragma pack(show) == 8</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="c1">#pragma pack(show)</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">        </span>^
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="m">1</span><span class="w"> </span>warning<span class="w"> </span>generated.
</span></code></pre></div>
<p>rpi4b-ubuntu/arm64 下 GCC 不支持预编译指令选项 <code>show</code>。</p>
<hr />
<p>MSVC 和 GCC 等编译器中都支持通过预编译处理指令 <code>#pragma pack(n)</code> 来改变编译器的默认对齐方式。</p>
<p><a href="https://learn.microsoft.com/en-us/cpp/preprocessor/pack">pack pragma | Microsoft Learn</a></p>
<blockquote>
<p>To <em>pack</em> a class is to place its members directly after each other in memory. It can mean that some or all members can be aligned on a boundary <strong><em>smaller</em></strong> than the default alignment of the target architecture. <code>pack</code> gives control at the data-declaration level.<br />
在 GCC 中，对于 <code>#pragma pack(n)</code> 中的结构体而言，相当于 <code>-fpack-struct[=n]</code>，指定 <strong><em>maximum</em></strong> alignment 对齐策略，可能小于默认的对齐参数。</p>
</blockquote>
<div class="language-c highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="cp">#pragma pack(n)</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="c1">// to be packed</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="cp">#pragma pack()</span>
</span></code></pre></div>
<p>在 <code>#pragma pack(n)</code> 和 <code>#pragma pack()</code> 之间的代码将按 <code>n</code> 字节对齐。</p>
<p>成员对齐有一个重要的条件，即每个成员按自己的方式对齐，也就是说虽然指定了按 n 字节对齐，但并不是所有的成员都是以 n 字节对齐。其对齐的规则是：每个成员按其类型的对齐参数（通常是这个类型的大小）和指定对齐参数（这里是n字节）中较小的一个对齐，即 <code>min(n, sizeof(item))</code>，并且结构的长度必须为所用过的所有对齐参数的整数倍，不够就填充字节。</p>
<ol>
<li>如果 n &gt;= sizeof(item)，成员变量按默认的对齐方式，即按照其 size 对齐，结构对齐后的总大小必须是成员中最大的对齐参数的整数倍，这样在处理数组时可以保证每一项都边界对齐。</li>
<li>如果 n &lt; sizeof(item)，成员变量的偏移量取 n 的倍数，不用满足默认的对齐方式，结构的总大小必须为 n 的倍数。</li>
</ol>
<p>默认 n=8，满足第一种情况的自然对齐；当 n&gt;8，不再有实际影响。</p>
<p>下面举例说明通过 <code>#pragma pack(n)</code> 指定 n&lt;8 时，对结构存储布局的影响。</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="cp">#pragma pack(push)</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="cp">#pragma pack(4)</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="k">struct</span><span class="w"> </span><span class="nc">st_cdi</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="p">{</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="p">};</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="cp">#pragma pack(pop)</span>
</span></code></pre></div>
<ol>
<li>首先，为c分配空间，其偏移量为0，满足n=4字节对齐方式，c占1个字节。</li>
<li>其次，为d分配空间，这时其偏移量为1，需填补3个字节，对齐n=4（不必按sizeof(double)=8 对齐），d占8个字节。</li>
<li>最后，为i分配空间，这时其偏移量为12，满足为n=4的倍数，i占4个字节。</li>
<li>三个成员共分配了16个字节，满足为n=4的倍数，故 sizeof(st_cdi) = 16。</li>
</ol>
<p>如果把 <code>#pragma pack(4)</code> 改为 <code>#pragma pack(16)</code>，那么结构的大小就是 n&gt;8 自然对齐下的24，相当于不受影响。</p>
<h2 id="test_alignment">test alignment<a class="headerlink" href="#test_alignment" title="Permanent link">#</a></h2>
<p>以下测试代码 struct-packed-aligned.c，综合测试通过指定 <code>__attribute__</code> 和 <code>#pragma pack</code> 改变结构体默认的对齐方式。</p>
<ol>
<li>
<p>可执行 <code>cpp struct-packed-aligned.c</code>（或 <code>gcc -E</code>）查看宏 <code>DEFINE_STRUCT_PAIR</code> / <code>DEFINE_STRUCT_ALIGNED</code> 的展开结果。</p>
</li>
<li>
<p>DEFINE_STRUCT_PAIR 给结构体定义加上属性限定 <code>__attribute__((__packed__))</code> 定义 <code>StructName##_packed</code>（MyStruct1_packed，MyStruct2_packed），不考虑成员变量的“地址边界对齐限制”，各成员变量依序自然紧凑排列，其大小是各个成员 sizeof 之和。</p>
</li>
<li>
<p>DEFINE_STRUCT_ALIGNED 指定 <code>__attribute__((aligned(16)))</code> 定义 <code>struct MyStruct4_aligned</code>，后者必须满足整体大小为 n=16 的倍数，sizeof 测算结果为 32。</p>
<ul>
<li>参考 <a href="https://learn.microsoft.com/en-us/cpp/build/x64-software-conventions#x64-structure-alignment-examples">x64 structure alignment examples</a>。</li>
</ul>
</li>
</ol>
<details class="info">
<summary>struct-packed-aligned.c</summary>
<div class="language-c highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">  1</a></span>
<span class="normal"><a href="#__codelineno-12-2">  2</a></span>
<span class="normal"><a href="#__codelineno-12-3">  3</a></span>
<span class="normal"><a href="#__codelineno-12-4">  4</a></span>
<span class="normal"><a href="#__codelineno-12-5">  5</a></span>
<span class="normal"><a href="#__codelineno-12-6">  6</a></span>
<span class="normal"><a href="#__codelineno-12-7">  7</a></span>
<span class="normal"><a href="#__codelineno-12-8">  8</a></span>
<span class="normal"><a href="#__codelineno-12-9">  9</a></span>
<span class="normal"><a href="#__codelineno-12-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-12-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-12-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-12-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-12-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-12-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-12-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-12-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-12-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-12-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-12-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-12-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-12-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-12-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-12-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-12-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-12-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-12-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-12-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-12-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-12-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-12-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-12-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-12-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-12-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-12-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-12-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-12-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-12-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-12-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-12-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-12-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-12-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-12-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-12-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-12-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-12-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-12-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-12-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-12-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-12-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-12-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-12-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-12-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-12-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-12-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-12-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-12-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-12-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-12-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-12-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-12-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-12-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-12-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-12-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-12-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-12-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-12-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-12-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-12-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-12-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-12-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-12-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-12-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-12-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-12-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-12-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-12-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-12-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-12-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-12-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-12-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-12-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-12-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-12-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-12-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-12-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-12-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-12-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-12-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-12-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-12-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-12-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-12-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-12-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-12-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-12-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-12-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-12-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-12-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-12-100">100</a></span>
<span class="normal"><a href="#__codelineno-12-101">101</a></span>
<span class="normal"><a href="#__codelineno-12-102">102</a></span>
<span class="normal"><a href="#__codelineno-12-103">103</a></span>
<span class="normal"><a href="#__codelineno-12-104">104</a></span>
<span class="normal"><a href="#__codelineno-12-105">105</a></span>
<span class="normal"><a href="#__codelineno-12-106">106</a></span>
<span class="normal"><a href="#__codelineno-12-107">107</a></span>
<span class="normal"><a href="#__codelineno-12-108">108</a></span>
<span class="normal"><a href="#__codelineno-12-109">109</a></span>
<span class="normal"><a href="#__codelineno-12-110">110</a></span>
<span class="normal"><a href="#__codelineno-12-111">111</a></span>
<span class="normal"><a href="#__codelineno-12-112">112</a></span>
<span class="normal"><a href="#__codelineno-12-113">113</a></span>
<span class="normal"><a href="#__codelineno-12-114">114</a></span>
<span class="normal"><a href="#__codelineno-12-115">115</a></span>
<span class="normal"><a href="#__codelineno-12-116">116</a></span>
<span class="normal"><a href="#__codelineno-12-117">117</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stddef.h&gt;</span><span class="c1">     // size_t, max_align_t, offsetof</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdalign.h&gt;</span><span class="c1">   // alignof, alignas</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdint.h&gt;</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5"></a>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Readout</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="p">{</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">hour</span><span class="p">;</span><span class="w">  </span><span class="c1">// [0:23]</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">seq</span><span class="p">;</span><span class="w">   </span><span class="c1">// sequence mark [&#39;a&#39;:&#39;z&#39;]</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="p">};</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12"></a>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="c1">// __attribute__ ((__packed__))</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="c1">// struct&#39;s members are packed closely together,</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15"></a><span class="c1">// but the internal layout of its s member is not packed</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16"></a><span class="cp">#define DEFINE_STRUCT_PAIR(StructName, StructBody) \</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17"></a><span class="cp">    struct StructName StructBody \</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18"></a><span class="cp">    struct __attribute__((__packed__)) StructName##_packed StructBody</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19"></a><span class="cp">#define GET_PACKED_SIZE(StructName) sizeof(struct StructName##_packed)</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20"></a><span class="cp">#define GET_SIZE(StructName) sizeof(struct StructName)</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21"></a>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22"></a><span class="c1">// aligned (alignment): specifies a minimum alignment</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23"></a><span class="cp">#define DEFINE_STRUCT_ALIGNED(n, StructName, StructBody) \</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24"></a><span class="cp">    struct __attribute__((aligned(n))) StructName##_aligned StructBody</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25"></a><span class="cp">#define GET_ALIGNED_SIZE(StructName) sizeof(struct StructName##_aligned)</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26"></a>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27"></a><span class="n">DEFINE_STRUCT_PAIR</span><span class="p">(</span><span class="n">MyStruct1</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31"></a><span class="p">};)</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32"></a>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33"></a><span class="n">DEFINE_STRUCT_PAIR</span><span class="p">(</span><span class="n">MyStruct2</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37"></a><span class="p">};)</span>
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38"></a>
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39"></a><span class="cp">#pragma pack(push, 4)</span>
</span><span id="__span-12-40"><a id="__codelineno-12-40" name="__codelineno-12-40"></a><span class="k">struct</span><span class="w"> </span><span class="nc">MyStruct3</span>
</span><span id="__span-12-41"><a id="__codelineno-12-41" name="__codelineno-12-41"></a><span class="p">{</span>
</span><span id="__span-12-42"><a id="__codelineno-12-42" name="__codelineno-12-42"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
</span><span id="__span-12-43"><a id="__codelineno-12-43" name="__codelineno-12-43"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
</span><span id="__span-12-44"><a id="__codelineno-12-44" name="__codelineno-12-44"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-12-45"><a id="__codelineno-12-45" name="__codelineno-12-45"></a><span class="p">};</span>
</span><span id="__span-12-46"><a id="__codelineno-12-46" name="__codelineno-12-46"></a><span class="cp">#pragma pack(pop)</span>
</span><span id="__span-12-47"><a id="__codelineno-12-47" name="__codelineno-12-47"></a>
</span><span id="__span-12-48"><a id="__codelineno-12-48" name="__codelineno-12-48"></a><span class="n">DEFINE_STRUCT_ALIGNED</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">MyStruct3</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-49"><a id="__codelineno-12-49" name="__codelineno-12-49"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
</span><span id="__span-12-50"><a id="__codelineno-12-50" name="__codelineno-12-50"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
</span><span id="__span-12-51"><a id="__codelineno-12-51" name="__codelineno-12-51"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-12-52"><a id="__codelineno-12-52" name="__codelineno-12-52"></a><span class="p">};)</span>
</span><span id="__span-12-53"><a id="__codelineno-12-53" name="__codelineno-12-53"></a>
</span><span id="__span-12-54"><a id="__codelineno-12-54" name="__codelineno-12-54"></a><span class="cp">#pragma pack(push, 16)</span>
</span><span id="__span-12-55"><a id="__codelineno-12-55" name="__codelineno-12-55"></a><span class="k">struct</span><span class="w"> </span><span class="nc">MyStruct4</span>
</span><span id="__span-12-56"><a id="__codelineno-12-56" name="__codelineno-12-56"></a><span class="p">{</span>
</span><span id="__span-12-57"><a id="__codelineno-12-57" name="__codelineno-12-57"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
</span><span id="__span-12-58"><a id="__codelineno-12-58" name="__codelineno-12-58"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
</span><span id="__span-12-59"><a id="__codelineno-12-59" name="__codelineno-12-59"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-12-60"><a id="__codelineno-12-60" name="__codelineno-12-60"></a><span class="p">};</span>
</span><span id="__span-12-61"><a id="__codelineno-12-61" name="__codelineno-12-61"></a><span class="cp">#pragma pack(pop)</span>
</span><span id="__span-12-62"><a id="__codelineno-12-62" name="__codelineno-12-62"></a>
</span><span id="__span-12-63"><a id="__codelineno-12-63" name="__codelineno-12-63"></a><span class="c1">// on a 16-byte boundary.</span>
</span><span id="__span-12-64"><a id="__codelineno-12-64" name="__codelineno-12-64"></a><span class="n">DEFINE_STRUCT_ALIGNED</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="n">MyStruct4</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-65"><a id="__codelineno-12-65" name="__codelineno-12-65"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
</span><span id="__span-12-66"><a id="__codelineno-12-66" name="__codelineno-12-66"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
</span><span id="__span-12-67"><a id="__codelineno-12-67" name="__codelineno-12-67"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-12-68"><a id="__codelineno-12-68" name="__codelineno-12-68"></a><span class="p">};)</span>
</span><span id="__span-12-69"><a id="__codelineno-12-69" name="__codelineno-12-69"></a>
</span><span id="__span-12-70"><a id="__codelineno-12-70" name="__codelineno-12-70"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
</span><span id="__span-12-71"><a id="__codelineno-12-71" name="__codelineno-12-71"></a><span class="p">{</span>
</span><span id="__span-12-72"><a id="__codelineno-12-72" name="__codelineno-12-72"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;sizeof pointer=%zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">));</span>
</span><span id="__span-12-73"><a id="__codelineno-12-73" name="__codelineno-12-73"></a>
</span><span id="__span-12-74"><a id="__codelineno-12-74" name="__codelineno-12-74"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;alignof(char)=%zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">alignof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
</span><span id="__span-12-75"><a id="__codelineno-12-75" name="__codelineno-12-75"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;alignof(short)=%zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">alignof</span><span class="p">(</span><span class="kt">short</span><span class="p">));</span>
</span><span id="__span-12-76"><a id="__codelineno-12-76" name="__codelineno-12-76"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;alignof(int)=%zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">alignof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
</span><span id="__span-12-77"><a id="__codelineno-12-77" name="__codelineno-12-77"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;alignof(long)=%zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">alignof</span><span class="p">(</span><span class="kt">long</span><span class="p">));</span>
</span><span id="__span-12-78"><a id="__codelineno-12-78" name="__codelineno-12-78"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;alignof(long long)=%zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">alignof</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">));</span>
</span><span id="__span-12-79"><a id="__codelineno-12-79" name="__codelineno-12-79"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;alignof(double)=%zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">alignof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
</span><span id="__span-12-80"><a id="__codelineno-12-80" name="__codelineno-12-80"></a>
</span><span id="__span-12-81"><a id="__codelineno-12-81" name="__codelineno-12-81"></a><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">ma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">alignof</span><span class="p">(</span><span class="n">max_align_t</span><span class="p">);</span>
</span><span id="__span-12-82"><a id="__codelineno-12-82" name="__codelineno-12-82"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;alignof(max_align_t)=%zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ma</span><span class="p">);</span>
</span><span id="__span-12-83"><a id="__codelineno-12-83" name="__codelineno-12-83"></a>
</span><span id="__span-12-84"><a id="__codelineno-12-84" name="__codelineno-12-84"></a><span class="w">    </span><span class="n">puts</span><span class="p">(</span><span class="s">&quot;----------------------------------------&quot;</span><span class="p">);</span>
</span><span id="__span-12-85"><a id="__codelineno-12-85" name="__codelineno-12-85"></a>
</span><span id="__span-12-86"><a id="__codelineno-12-86" name="__codelineno-12-86"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;sizeof(Readout)=%zu, alignof(Readout)=%zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span id="__span-12-87"><a id="__codelineno-12-87" name="__codelineno-12-87"></a><span class="w">            </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">Readout</span><span class="p">),</span><span class="w"> </span><span class="k">alignof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">Readout</span><span class="p">));</span>
</span><span id="__span-12-88"><a id="__codelineno-12-88" name="__codelineno-12-88"></a>
</span><span id="__span-12-89"><a id="__codelineno-12-89" name="__codelineno-12-89"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;sizeof(MyStruct1)=%zu,%zu, alignof(MyStruct1)=%zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span id="__span-12-90"><a id="__codelineno-12-90" name="__codelineno-12-90"></a><span class="w">        </span><span class="n">GET_PACKED_SIZE</span><span class="p">(</span><span class="n">MyStruct1</span><span class="p">),</span><span class="w"> </span><span class="n">GET_SIZE</span><span class="p">(</span><span class="n">MyStruct1</span><span class="p">),</span>
</span><span id="__span-12-91"><a id="__codelineno-12-91" name="__codelineno-12-91"></a><span class="w">        </span><span class="k">alignof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">MyStruct1</span><span class="p">));</span>
</span><span id="__span-12-92"><a id="__codelineno-12-92" name="__codelineno-12-92"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;sizeof(MyStruct2)=%zu,%zu, alignof(MyStruct2)=%zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span id="__span-12-93"><a id="__codelineno-12-93" name="__codelineno-12-93"></a><span class="w">        </span><span class="n">GET_PACKED_SIZE</span><span class="p">(</span><span class="n">MyStruct2</span><span class="p">),</span><span class="w"> </span><span class="n">GET_SIZE</span><span class="p">(</span><span class="n">MyStruct2</span><span class="p">),</span>
</span><span id="__span-12-94"><a id="__codelineno-12-94" name="__codelineno-12-94"></a><span class="w">        </span><span class="k">alignof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">MyStruct2</span><span class="p">));</span>
</span><span id="__span-12-95"><a id="__codelineno-12-95" name="__codelineno-12-95"></a>
</span><span id="__span-12-96"><a id="__codelineno-12-96" name="__codelineno-12-96"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">MyStruct2</span><span class="w"> </span><span class="n">ms2</span><span class="p">;</span>
</span><span id="__span-12-97"><a id="__codelineno-12-97" name="__codelineno-12-97"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;MyStruct2 offsets: c=%zu, d=%zu, i=%zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span id="__span-12-98"><a id="__codelineno-12-98" name="__codelineno-12-98"></a><span class="w">        </span><span class="n">offsetof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">MyStruct2</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">),</span>
</span><span id="__span-12-99"><a id="__codelineno-12-99" name="__codelineno-12-99"></a><span class="w">        </span><span class="n">offsetof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">MyStruct2</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">),</span>
</span><span id="__span-12-100"><a id="__codelineno-12-100" name="__codelineno-12-100"></a><span class="w">        </span><span class="p">(</span><span class="kt">uintptr_t</span><span class="p">)</span><span class="o">&amp;</span><span class="n">ms2</span><span class="p">.</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="kt">uintptr_t</span><span class="p">)</span><span class="o">&amp;</span><span class="n">ms2</span><span class="p">);</span>
</span><span id="__span-12-101"><a id="__codelineno-12-101" name="__codelineno-12-101"></a>
</span><span id="__span-12-102"><a id="__codelineno-12-102" name="__codelineno-12-102"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;sizeof(MyStruct3): pack(4)=%zu, aligned(4)=%zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span id="__span-12-103"><a id="__codelineno-12-103" name="__codelineno-12-103"></a><span class="w">        </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">MyStruct3</span><span class="p">),</span>
</span><span id="__span-12-104"><a id="__codelineno-12-104" name="__codelineno-12-104"></a><span class="w">        </span><span class="n">GET_ALIGNED_SIZE</span><span class="p">(</span><span class="n">MyStruct3</span><span class="p">));</span>
</span><span id="__span-12-105"><a id="__codelineno-12-105" name="__codelineno-12-105"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;alignof(MyStruct3): pack(4)=%zu, aligned(4)=%zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span id="__span-12-106"><a id="__codelineno-12-106" name="__codelineno-12-106"></a><span class="w">        </span><span class="k">alignof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">MyStruct3</span><span class="p">),</span>
</span><span id="__span-12-107"><a id="__codelineno-12-107" name="__codelineno-12-107"></a><span class="w">        </span><span class="k">alignof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">MyStruct3_aligned</span><span class="p">));</span>
</span><span id="__span-12-108"><a id="__codelineno-12-108" name="__codelineno-12-108"></a>
</span><span id="__span-12-109"><a id="__codelineno-12-109" name="__codelineno-12-109"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;sizeof(MyStruct4): pack(16)=%zu, aligned(16)=%zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span id="__span-12-110"><a id="__codelineno-12-110" name="__codelineno-12-110"></a><span class="w">        </span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">MyStruct4</span><span class="p">),</span>
</span><span id="__span-12-111"><a id="__codelineno-12-111" name="__codelineno-12-111"></a><span class="w">        </span><span class="n">GET_ALIGNED_SIZE</span><span class="p">(</span><span class="n">MyStruct4</span><span class="p">));</span>
</span><span id="__span-12-112"><a id="__codelineno-12-112" name="__codelineno-12-112"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;alignof(MyStruct4): pack(16)=%zu, aligned(16)=%zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
</span><span id="__span-12-113"><a id="__codelineno-12-113" name="__codelineno-12-113"></a><span class="w">        </span><span class="k">alignof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">MyStruct4</span><span class="p">),</span>
</span><span id="__span-12-114"><a id="__codelineno-12-114" name="__codelineno-12-114"></a><span class="w">        </span><span class="k">alignof</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">MyStruct4_aligned</span><span class="p">));</span>
</span><span id="__span-12-115"><a id="__codelineno-12-115" name="__codelineno-12-115"></a>
</span><span id="__span-12-116"><a id="__codelineno-12-116" name="__codelineno-12-116"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-12-117"><a id="__codelineno-12-117" name="__codelineno-12-117"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</details>
<p>mbpa1398-macOS/x86_64、mbpa2991-macOS/arm64 和 rpi4b-ubuntu/aarch64 LP64 数据模式下输出结果如下：</p>
<div class="language-Shell highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># cc struct-packed-aligned.c -o struct-packed-aligned &amp;&amp; ./struct-packed-aligned</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>$<span class="w"> </span>cc<span class="w"> </span>struct-packed-aligned.c<span class="w"> </span>-o<span class="w"> </span>struct-packed-aligned<span class="w"> </span>-g<span class="w"> </span>-fno-eliminate-unused-debug-types<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./struct-packed-aligned
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>sizeof<span class="w"> </span><span class="nv">pointer</span><span class="o">=</span><span class="m">8</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>alignof<span class="o">(</span>char<span class="o">)=</span><span class="m">1</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>alignof<span class="o">(</span>short<span class="o">)=</span><span class="m">2</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>alignof<span class="o">(</span>int<span class="o">)=</span><span class="m">4</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>alignof<span class="o">(</span>long<span class="o">)=</span><span class="m">8</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>alignof<span class="o">(</span>long<span class="w"> </span>long<span class="o">)=</span><span class="m">8</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>alignof<span class="o">(</span>double<span class="o">)=</span><span class="m">8</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>alignof<span class="o">(</span>max_align_t<span class="o">)=</span><span class="m">8</span><span class="w"> </span><span class="o">(</span>comment:<span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>x86_64<span class="w"> </span>and<span class="w"> </span>aarch64<span class="o">)</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>----------------------------------------
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>sizeof<span class="o">(</span>Readout<span class="o">)=</span><span class="m">12</span>,<span class="w"> </span>alignof<span class="o">(</span>Readout<span class="o">)=</span><span class="m">4</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>sizeof<span class="o">(</span>MyStruct1<span class="o">)=</span><span class="m">13</span>,16,<span class="w"> </span>alignof<span class="o">(</span>MyStruct1<span class="o">)=</span><span class="m">8</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>sizeof<span class="o">(</span>MyStruct2<span class="o">)=</span><span class="m">13</span>,24,<span class="w"> </span>alignof<span class="o">(</span>MyStruct2<span class="o">)=</span><span class="m">8</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>MyStruct2<span class="w"> </span>offsets:<span class="w"> </span><span class="nv">c</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">d</span><span class="o">=</span><span class="m">8</span>,<span class="w"> </span><span class="nv">i</span><span class="o">=</span><span class="m">16</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>sizeof<span class="o">(</span>MyStruct3<span class="o">)</span>:<span class="w"> </span>pack<span class="o">(</span><span class="m">4</span><span class="o">)=</span><span class="m">16</span>,<span class="w"> </span>aligned<span class="o">(</span><span class="m">4</span><span class="o">)=</span><span class="m">24</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>alignof<span class="o">(</span>MyStruct3<span class="o">)</span>:<span class="w"> </span>pack<span class="o">(</span><span class="m">4</span><span class="o">)=</span><span class="m">4</span>,<span class="w"> </span>aligned<span class="o">(</span><span class="m">4</span><span class="o">)=</span><span class="m">8</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>sizeof<span class="o">(</span>MyStruct4<span class="o">)</span>:<span class="w"> </span>pack<span class="o">(</span><span class="m">16</span><span class="o">)=</span><span class="m">24</span>,<span class="w"> </span>aligned<span class="o">(</span><span class="m">16</span><span class="o">)=</span><span class="m">32</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>alignof<span class="o">(</span>MyStruct4<span class="o">)</span>:<span class="w"> </span>pack<span class="o">(</span><span class="m">16</span><span class="o">)=</span><span class="m">8</span>,<span class="w"> </span>aligned<span class="o">(</span><span class="m">16</span><span class="o">)=</span><span class="m">16</span>
</span></code></pre></div>
<h3 id="interpretation">interpretation<a class="headerlink" href="#interpretation" title="Permanent link">#</a></h3>
<p><strong>运行调试</strong>：</p>
<ol>
<li>编译添加 <code>-g</code> 选项生成调试信息，添加 <code>-fno-eliminate-unused-debug-types</code>；</li>
<li><code>gdb struct-packed-aligned</code> 进入 GDB Console，执行 <code>start</code> 启动运行。</li>
</ol>
<p><strong>结果分析</strong>：</p>
<ol>
<li>
<p>struct Readout、MyStruct1、MyStruct2，采用 default natural alignment 对齐策略，遵循“地址边界对齐限制”。</p>
<div class="admonition info">
<p class="admonition-title">gdb ptype /o MyStruct3</p>
<div class="language-Shell highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>ptype<span class="w"> </span>/o<span class="w"> </span>struct<span class="w"> </span>Readout
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>/*<span class="w"> </span>offset<span class="w">      </span><span class="p">|</span><span class="w">    </span>size<span class="w"> </span>*/<span class="w">  </span><span class="nb">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>struct<span class="w"> </span>Readout<span class="w"> </span><span class="o">{</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>/*<span class="w">      </span><span class="m">0</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">1</span><span class="w"> </span>*/<span class="w">    </span>char<span class="w"> </span>hour<span class="p">;</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>/*<span class="w"> </span>XXX<span class="w">  </span><span class="m">3</span>-byte<span class="w"> </span>hole<span class="w">      </span>*/
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>/*<span class="w">      </span><span class="m">4</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">4</span><span class="w"> </span>*/<span class="w">    </span>int<span class="w"> </span>value<span class="p">;</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>/*<span class="w">      </span><span class="m">8</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">1</span><span class="w"> </span>*/<span class="w">    </span>char<span class="w"> </span>seq<span class="p">;</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>/*<span class="w"> </span>XXX<span class="w">  </span><span class="m">3</span>-byte<span class="w"> </span>padding<span class="w">   </span>*/
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">                            </span>/*<span class="w"> </span>total<span class="w"> </span>size<span class="w"> </span><span class="o">(</span>bytes<span class="o">)</span>:<span class="w">   </span><span class="m">12</span><span class="w"> </span>*/
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">                            </span><span class="o">}</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>ptype<span class="w"> </span>/o<span class="w"> </span>struct<span class="w"> </span>MyStruct1
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>/*<span class="w"> </span>offset<span class="w">      </span><span class="p">|</span><span class="w">    </span>size<span class="w"> </span>*/<span class="w">  </span><span class="nb">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>struct<span class="w"> </span>MyStruct1<span class="w"> </span><span class="o">{</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>/*<span class="w">      </span><span class="m">0</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">8</span><span class="w"> </span>*/<span class="w">    </span>double<span class="w"> </span>d<span class="p">;</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>/*<span class="w">      </span><span class="m">8</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">1</span><span class="w"> </span>*/<span class="w">    </span>char<span class="w"> </span>c<span class="p">;</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>/*<span class="w"> </span>XXX<span class="w">  </span><span class="m">3</span>-byte<span class="w"> </span>hole<span class="w">      </span>*/
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>/*<span class="w">     </span><span class="m">12</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">4</span><span class="w"> </span>*/<span class="w">    </span>int<span class="w"> </span>i<span class="p">;</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">                            </span>/*<span class="w"> </span>total<span class="w"> </span>size<span class="w"> </span><span class="o">(</span>bytes<span class="o">)</span>:<span class="w">   </span><span class="m">16</span><span class="w"> </span>*/
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w">                            </span><span class="o">}</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>ptype<span class="w"> </span>/o<span class="w"> </span>struct<span class="w"> </span>MyStruct2
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>/*<span class="w"> </span>offset<span class="w">      </span><span class="p">|</span><span class="w">    </span>size<span class="w"> </span>*/<span class="w">  </span><span class="nb">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>struct<span class="w"> </span>MyStruct2<span class="w"> </span><span class="o">{</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>/*<span class="w">      </span><span class="m">0</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">1</span><span class="w"> </span>*/<span class="w">    </span>char<span class="w"> </span>c<span class="p">;</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>/*<span class="w"> </span>XXX<span class="w">  </span><span class="m">7</span>-byte<span class="w"> </span>hole<span class="w">      </span>*/
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>/*<span class="w">      </span><span class="m">8</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">8</span><span class="w"> </span>*/<span class="w">    </span>double<span class="w"> </span>d<span class="p">;</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>/*<span class="w">     </span><span class="m">16</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">4</span><span class="w"> </span>*/<span class="w">    </span>int<span class="w"> </span>i<span class="p">;</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>/*<span class="w"> </span>XXX<span class="w">  </span><span class="m">4</span>-byte<span class="w"> </span>padding<span class="w">   </span>*/
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="w">                            </span>/*<span class="w"> </span>total<span class="w"> </span>size<span class="w"> </span><span class="o">(</span>bytes<span class="o">)</span>:<span class="w">   </span><span class="m">24</span><span class="w"> </span>*/
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="w">                            </span><span class="o">}</span>
</span></code></pre></div>
</div>
</li>
<li>
<p>对于 MyStruct3：<code>#pragma pack(4)</code>，指定 maximum alignment=4 &lt; default，alignof=min{n, default}=n=4，d 不遵从自然对齐，sizeof=16。</p>
<div class="admonition info">
<p class="admonition-title">gdb ptype /o MyStruct3</p>
<div class="language-Shell highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>ptype<span class="w"> </span>/o<span class="w"> </span>struct<span class="w"> </span>MyStruct3
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>/*<span class="w"> </span>offset<span class="w">      </span><span class="p">|</span><span class="w">    </span>size<span class="w"> </span>*/<span class="w">  </span><span class="nb">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>struct<span class="w"> </span>MyStruct3<span class="w"> </span><span class="o">{</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>/*<span class="w">      </span><span class="m">0</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">1</span><span class="w"> </span>*/<span class="w">    </span>char<span class="w"> </span>c<span class="p">;</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>/*<span class="w"> </span>XXX<span class="w">  </span><span class="m">3</span>-byte<span class="w"> </span>hole<span class="w">      </span>*/
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>/*<span class="w">      </span><span class="m">4</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">8</span><span class="w"> </span>*/<span class="w">    </span>double<span class="w"> </span>d<span class="p">;</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>/*<span class="w">     </span><span class="m">12</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">4</span><span class="w"> </span>*/<span class="w">    </span>int<span class="w"> </span>i<span class="p">;</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">                            </span>/*<span class="w"> </span>total<span class="w"> </span>size<span class="w"> </span><span class="o">(</span>bytes<span class="o">)</span>:<span class="w">   </span><span class="m">16</span><span class="w"> </span>*/
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">                            </span><span class="o">}</span>
</span></code></pre></div>
</div>
</li>
<li>
<p>对于 MyStruct3_aligned (4)：指定 minimum alignment=4 &lt; default，alignof=max{n, default}=default=8，结构体按自然对齐，sizeof=24。</p>
<div class="admonition info">
<p class="admonition-title">gdb ptype /o MyStruct3_aligned</p>
<div class="language-Shell highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>ptype<span class="w"> </span>/o<span class="w"> </span>struct<span class="w"> </span>MyStruct3_aligned
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>/*<span class="w"> </span>offset<span class="w">      </span><span class="p">|</span><span class="w">    </span>size<span class="w"> </span>*/<span class="w">  </span><span class="nb">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>struct<span class="w"> </span>MyStruct3_aligned<span class="w"> </span><span class="o">{</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>/*<span class="w">      </span><span class="m">0</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">1</span><span class="w"> </span>*/<span class="w">    </span>char<span class="w"> </span>c<span class="p">;</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>/*<span class="w"> </span>XXX<span class="w">  </span><span class="m">7</span>-byte<span class="w"> </span>hole<span class="w">      </span>*/
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>/*<span class="w">      </span><span class="m">8</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">8</span><span class="w"> </span>*/<span class="w">    </span>double<span class="w"> </span>d<span class="p">;</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>/*<span class="w">     </span><span class="m">16</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">4</span><span class="w"> </span>*/<span class="w">    </span>int<span class="w"> </span>i<span class="p">;</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>/*<span class="w"> </span>XXX<span class="w">  </span><span class="m">4</span>-byte<span class="w"> </span>padding<span class="w">   </span>*/
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">                            </span>/*<span class="w"> </span>total<span class="w"> </span>size<span class="w"> </span><span class="o">(</span>bytes<span class="o">)</span>:<span class="w">   </span><span class="m">24</span><span class="w"> </span>*/
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">                            </span><span class="o">}</span>
</span></code></pre></div>
</div>
</li>
<li>
<p>对于 MyStruct4：<code>#pragma pack(16)</code>，指定 maximum alignment=16 &gt; default，alignof=min{n, default}=default=8，结构体按自然对齐，sizeof=24。</p>
<div class="admonition info">
<p class="admonition-title">gdb ptype /o MyStruct4</p>
<div class="language-Shell highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>ptype<span class="w"> </span>/o<span class="w"> </span>struct<span class="w"> </span>MyStruct4
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>/*<span class="w"> </span>offset<span class="w">      </span><span class="p">|</span><span class="w">    </span>size<span class="w"> </span>*/<span class="w">  </span><span class="nb">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>struct<span class="w"> </span>MyStruct4<span class="w"> </span><span class="o">{</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>/*<span class="w">      </span><span class="m">0</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">1</span><span class="w"> </span>*/<span class="w">    </span>char<span class="w"> </span>c<span class="p">;</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>/*<span class="w"> </span>XXX<span class="w">  </span><span class="m">7</span>-byte<span class="w"> </span>hole<span class="w">      </span>*/
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>/*<span class="w">      </span><span class="m">8</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">8</span><span class="w"> </span>*/<span class="w">    </span>double<span class="w"> </span>d<span class="p">;</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>/*<span class="w">     </span><span class="m">16</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">4</span><span class="w"> </span>*/<span class="w">    </span>int<span class="w"> </span>i<span class="p">;</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>/*<span class="w"> </span>XXX<span class="w">  </span><span class="m">4</span>-byte<span class="w"> </span>padding<span class="w">   </span>*/
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">                            </span>/*<span class="w"> </span>total<span class="w"> </span>size<span class="w"> </span><span class="o">(</span>bytes<span class="o">)</span>:<span class="w">   </span><span class="m">24</span><span class="w"> </span>*/
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">                            </span><span class="o">}</span>
</span></code></pre></div>
</div>
</li>
<li>
<p>对于 MyStruct4_aligned (16)：指定 minimum alignment=16 &gt; default，alignof=max{n, default}=n=16，结构体按自然对齐，并且总大小必须为 16 的倍数，故 sizeof=32。</p>
<div class="admonition info">
<p class="admonition-title">gdb ptype /o MyStruct4_aligned</p>
<div class="language-Shell highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="o">(</span>gdb<span class="o">)</span><span class="w"> </span>ptype<span class="w"> </span>/o<span class="w"> </span>struct<span class="w"> </span>MyStruct4_aligned
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>/*<span class="w"> </span>offset<span class="w">      </span><span class="p">|</span><span class="w">    </span>size<span class="w"> </span>*/<span class="w">  </span><span class="nb">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>struct<span class="w"> </span>MyStruct4_aligned<span class="w"> </span><span class="o">{</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>/*<span class="w">      </span><span class="m">0</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">1</span><span class="w"> </span>*/<span class="w">    </span>char<span class="w"> </span>c<span class="p">;</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>/*<span class="w"> </span>XXX<span class="w">  </span><span class="m">7</span>-byte<span class="w"> </span>hole<span class="w">      </span>*/
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>/*<span class="w">      </span><span class="m">8</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">8</span><span class="w"> </span>*/<span class="w">    </span>double<span class="w"> </span>d<span class="p">;</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>/*<span class="w">     </span><span class="m">16</span><span class="w">      </span><span class="p">|</span><span class="w">       </span><span class="m">4</span><span class="w"> </span>*/<span class="w">    </span>int<span class="w"> </span>i<span class="p">;</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>/*<span class="w"> </span>XXX<span class="w"> </span><span class="m">12</span>-byte<span class="w"> </span>padding<span class="w">   </span>*/
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">                            </span>/*<span class="w"> </span>total<span class="w"> </span>size<span class="w"> </span><span class="o">(</span>bytes<span class="o">)</span>:<span class="w">   </span><span class="m">32</span><span class="w"> </span>*/
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">                            </span><span class="o">}</span>
</span></code></pre></div>
</div>
</li>
</ol>
<h2 id="refs">refs<a class="headerlink" href="#refs" title="Permanent link">#</a></h2>
<p><a href="https://interrupt.memfault.com/blog/c-struct-padding-initialization">C Structure Padding Initialization</a><br />
<a href="https://levelup.gitconnected.com/how-struct-memory-alignment-works-in-c-3ee897697236">How Struct Memory Alignment Works in C</a>  </p>
<p><a href="https://www.amazon.com/Computer-Systems-OHallaron-Randal-Bryant/dp/1292101768/">Computer Systems - A Programmer’s Perspective</a> - 3.9.3: Data Alignment</p>
<p><a href="https://book.douban.com/subject/19930393/">老码识途-从机器码到框架的系统观逆向修炼之路-2012</a> - 1.5 无法沟通——对齐的错误</p>







  
  



  


  



  <h2 id="__comments">评论</h2>
  <!-- Insert generated snippet here -->
  <script src="https://giscus.app/client.js"
    data-repo="fan2/mkdocs"
    data-repo-id="R_kgDOLltxSg"
    data-category="Announcements"
    data-category-id="DIC_kwDOLltxSs4CeURH"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="1"
    data-input-position="top"
    data-theme="preferred_color_scheme"
    data-lang="zh-CN"
    data-loading="lazy"
    crossorigin="anonymous"
    async>
  </script>

  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    // Set palette on initial load
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate"
        ? "transparent_dark"
        : "light"

      // Instruct Giscus to set theme
      giscus.setAttribute("data-theme", theme) 
    }

    // Register event handlers after documented loaded
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate"
            ? "transparent_dark"
            : "light"

          // Instruct Giscus to change theme
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>

      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../../20211012/address-alignment/" class="md-footer__link md-footer__link--prev" aria-label="上一页: Memory Address Alignment">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                Memory Address Alignment
              </div>
            </div>
          </a>
        
        
          
          <a href="../../20221212/2-Markdown-Formula/" class="md-footer__link md-footer__link--next" aria-label="下一页: Markdown Formula">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                Markdown Formula
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024- Cliff Fan
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["toc.follow", "header.autohide", "navigation.tabs", "navigation.top", "navigation.footer", "navigation.tracking", "content.code.copy", "content.code.select", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.bd41221c.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://vercount.one/js"></script>
      
    
  </body>
</html>